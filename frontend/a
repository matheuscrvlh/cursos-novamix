SELECT
    CONTAS_PAGAR_SALDOS_VIEW.IDEMPRESA AS ID_EMPRESA,
    EMPRESA.NOMEFANTASIA AS EMPRESA,
  --  CLIENTE_FORNECEDOR.IDCLIFOR AS IDCLIFOR,
   --(CLIENTE_FORNECEDOR.IDCLIFOR ||' - '|| CLIENTE_FORNECEDOR.NOME) AS FORNECEDOR,

    --CONTAS_PAGAR.DTEMISSAO AS DT_EMISSAO,
    --YEAR(CONTAS_PAGAR.DTEMISSAO) AS DT_EMISSAO_ANO,
    --MONTH(CONTAS_PAGAR.DTEMISSAO) AS DT_EMISSAO_MES,
    --CONTAS_PAGAR_SALDOS_VIEW.DTVENCIMENTO AS DT_VENCIMENTO,
    --CAST(CONTAS_PAGAR_SALDOS_VIEW.VALTITULO AS FLOAT) AS VL_TITULO,
    --CAST(CONTAS_PAGAR_SALDOS_VIEW.SUMVALDESCCONCEDIDOTITULO AS FLOAT) AS VL_DESCONTO,
    --CONTAS_PAGAR_SALDOS_VIEW.SUMVALPAGAMENTOTITULO AS SUMVALPAGAMENTOTITULO,
    SUM(CONTAS_PAGAR_SALDOS_VIEW.VALSALDOTITULO) AS CONTAS_PAGAR_FORNECEDOR,--
    SUM(CASE CLIENTE_FORNECEDOR.IDCLIFOR
            WHEN '1000100' THEN CONTAS_PAGAR_SALDOS_VIEW.VALSALDOTITULO
            ELSE 0
            END) AS CONTAS_PAGAR_CCN
    --CONTAS_PAGAR_SALDOS_VIEW.SUMVALJUROSMORA AS SUMVALJUROSMORA,
    --CONTAS_PAGAR_SALDOS_VIEW.SUMVALJUROSCOBRADO AS SUMVALJUROSCOBRADO,
    --CONTAS_PAGAR_SALDOS_VIEW.SUMVALJUROSISENTADO AS SUMVALJUROSISENTADO,
    --CONTAS_PAGAR_SALDOS_VIEW.SUMVALJUROSPOSTERGADO AS SUMVALJUROSPOSTERGADO,
    --CONTAS_PAGAR_SALDOS_VIEW.VALLIQUIDOTITULO AS VALLIQUIDOTITULO,
    --USUARIO.NOMEUSUARIO AS NOMEUSUARIO,

    --CONTAS_PAGAR_SALDOS_VIEW.IDPLANILHA AS IDPLANILHA,
    --CONTAS_PAGAR_SALDOS_VIEW.DIGITOTITULO AS DIGITOTITULO,
    --CONTAS_PAGAR_SALDOS_VIEW.SERIENOTA AS SERIENOTA,
    --CONTAS_PAGAR_SALDOS_VIEW.IDPAGAMENTO AS IDPAGAMENTO,
    --CONTAS_PAGAR_SALDOS_VIEW.ORIGEMMOVIMENTO AS ORIGEMMOVIMENTO,
    --CONTAS_PAGAR_SALDOS_VIEW.IDUSUARIO AS IDUSUARIO,
    --CONTAS_PAGAR_SALDOS_VIEW.FLAGCARTAOPROPRIO AS FLAGCARTAOPROPRIO,
    --CONTAS_PAGAR_SALDOS_VIEW.DTMOVIMENTO AS DTMOVIMENTO,
     -- CONTAS_PAGAR_SALDOS_VIEW.IDTITULO AS IDTITULO,

    --DAYS(CONTAS_PAGAR_SALDOS_VIEW.DTVENCIMENTO) - DAYS(CONTAS_PAGAR.DTEMISSAO) AS PRAZO,

    --CONTAS_PAGAR_SALDOS_VIEW.OBSTITULO AS OBSTITULO,
    --CONTAS_PAGAR.CODIGOBARRAS AS CODIGOBARRAS,
    --CONTAS_PAGAR.CODIGOBOLETO AS CODIGOBOLETO,
    --CLIENTE_FORNECEDOR.NOME AS NOME,
    --CONTAS_PAGAR_SALDOS_VIEW.IDCTACONTABIL AS IDCTACREDITO,
   --CONTABIL_PLANO_CONTAS.DESCRCTACONTABIL AS DESCRCTACREDITO,
   -- CONTABIL_PLANO_CONTAS_DEB.DESCRCTACONTABIL AS DESCRCTADEBITO,
    --CAST(SUM (COALESCE (CONTAS_PAGAR_BAIXAS.VALPAGAMENTOTITULO,0)) AS FLOAT) AS TOTAL_PAGAMENTOS,
    --CONTAS_PAGAR_SALDOS_VIEW.DTULTIMOPAGAMENTO AS DTULTIMOPAGAMENTO,
   -- CLIENTE_FORNECEDOR.TIPOCADASTRO AS TIPOCADASTRO,
   -- CASE CLIENTE_FORNECEDOR.TIPOCADASTRO
   --     WHEN 'A' THEN 'Cliente e Fornecedor'
   --     WHEN 'C' THEN 'Cliente'
   --     WHEN 'F' THEN 'Fornecedor'
   --     WHEN 'M' THEN 'Motorista'
   --     WHEN 'O' THEN 'Concorrente'
   --     WHEN 'P' THEN 'Cliente em Prospeccao'
   --     WHEN 'R' THEN 'Revenda/Sub-vendedor'
   --     WHEN 'U' THEN 'Funcionario/Colaborador'
   --     WHEN 'T' THEN 'Transportador'
   --     WHEN 'V' THEN 'Vendedor/Canal'
   --    WHEN 'I' THEN 'Revenda Importacao'
   --     ELSE 'NÃ£o Informado'
   -- END AS DSCTIPOCADASTRO,
   -- FORMA_PAGREC.DESCRRECEBIMENTO AS FORMAPAGAMENTO,
    --CLIENTE_FORNECEDOR.FLAGCLIENTEVIP AS FLAGCLIENTEVIP,
    --CONTAS_PAGAR.FLAGAGRUPADO AS FLAGAGRUPADO,
    --CONTAS_PAGAR.FLAGTITULOBLOQUEADO AS FLAGTITULOBLOQUEADO,
    --CONTAS_PAGAR.DTAGENDAMENTO AS DTAGENDAMENTO,
    --CONTAS_PAGAR.FLAGFLUXO AS FLAGFLUXO,

    --CONTAS_PAGAR_SALDOS_VIEW.PRAZOMEDIOORIGEM AS PRAZOMEDIO,
    --SUM (CAST (COALESCE (CONTAS_PAGAR_BAIXAS_AUX.VALPAGAMENTOTITULO,0) AS DECIMAL (15,6))) AS BAIXAAGRUPAMENTO,
    --CONTAS_PAGAR.FLAGBAIXADA AS BAIXADA,
   -- DBA.DIF_DIAS (CONTAS_PAGAR.DTVENCIMENTO,DBA.TODAY()) AS DIASAT,

   -- CONTABIL_PLANO_CONTAS.IDCTACONTABIL AS ID_CONTABIL,
   -- CONTABIL_PLANO_CONTAS.DESCRCTACONTABIL AS CONTA_CONTABIL
FROM
    DBA.CONTAS_PAGAR_SALDOS_VIEW AS CONTAS_PAGAR_SALDOS_VIEW
    INNER JOIN
        DBA.CLIENTE_FORNECEDOR AS CLIENTE_FORNECEDOR ON
            (CLIENTE_FORNECEDOR.IDCLIFOR = CONTAS_PAGAR_SALDOS_VIEW.IDCLIFOR)
    INNER JOIN
        DBA.CONTAS_PAGAR AS CONTAS_PAGAR ON
            (
                CONTAS_PAGAR_SALDOS_VIEW.IDEMPRESA = CONTAS_PAGAR.IDEMPRESA AND
                CONTAS_PAGAR_SALDOS_VIEW.IDCLIFOR = CONTAS_PAGAR.IDCLIFOR AND
                CONTAS_PAGAR_SALDOS_VIEW.IDTITULO = CONTAS_PAGAR.IDTITULO AND
                CONTAS_PAGAR_SALDOS_VIEW.DIGITOTITULO = CONTAS_PAGAR.DIGITOTITULO AND
                CONTAS_PAGAR_SALDOS_VIEW.SERIENOTA = CONTAS_PAGAR.SERIENOTA
            )
    INNER JOIN
        DBA.EMPRESA AS EMPRESA ON
            (CONTAS_PAGAR_SALDOS_VIEW.IDEMPRESA = EMPRESA.IDEMPRESA)
    INNER JOIN
        DBA.USUARIO AS USUARIO ON
            (USUARIO.IDUSUARIO = CONTAS_PAGAR_SALDOS_VIEW.IDUSUARIO)
    LEFT JOIN
        DBA.CONTABIL_PLANO_CONTAS AS CONTABIL_PLANO_CONTAS ON
            (CONTABIL_PLANO_CONTAS.IDCTACONTABIL = CONTAS_PAGAR_SALDOS_VIEW.IDCTACONTABIL)
   -- INNER JOIN
     --   DBA.CONTABIL_PLANO_CONTAS AS CONTABIL_PLANO_CONTAS_DEB ON
       --     (
         --       CONTABIL_PLANO_CONTAS_DEB.IDCTACONTABIL = DBA.UF_FRST_CPAG_PESQ (CONTAS_PAGAR_SALDOS_VIEW.IDEMPRESA,CONTAS_PAGAR_SALDOS_VIEW.IDPLANILHA,'D',CONTAS_PAGAR_SALDOS_VIEW.ORIGEMMOVIMENTO)
           -- )
    LEFT JOIN
        DBA.CONTAS_PAGAR_BAIXAS AS CONTAS_PAGAR_BAIXAS ON
            (
                CONTAS_PAGAR_BAIXAS.IDEMPRESA = CONTAS_PAGAR_SALDOS_VIEW.IDEMPRESA AND
                CONTAS_PAGAR_BAIXAS.IDCLIFOR = CONTAS_PAGAR_SALDOS_VIEW.IDCLIFOR AND
                CONTAS_PAGAR_BAIXAS.IDTITULO = CONTAS_PAGAR_SALDOS_VIEW.IDTITULO AND
                CONTAS_PAGAR_BAIXAS.DIGITOTITULO = CONTAS_PAGAR_SALDOS_VIEW.DIGITOTITULO AND
                CONTAS_PAGAR_BAIXAS.SERIENOTA = CONTAS_PAGAR_SALDOS_VIEW.SERIENOTA
            )
    LEFT JOIN
        DBA.CONTAS_PAGAR_BAIXAS AS CONTAS_PAGAR_BAIXAS_AUX ON
            (
                CONTAS_PAGAR_BAIXAS_AUX.IDTITULO = CONTAS_PAGAR_SALDOS_VIEW.IDTITULO AND
                CONTAS_PAGAR_BAIXAS_AUX.DIGITOTITULO = CONTAS_PAGAR_SALDOS_VIEW.DIGITOTITULO AND
                CONTAS_PAGAR_BAIXAS_AUX.IDCLIFOR = CONTAS_PAGAR_SALDOS_VIEW.IDCLIFOR AND
                CONTAS_PAGAR_BAIXAS_AUX.SERIENOTA = CONTAS_PAGAR_SALDOS_VIEW.SERIENOTA AND
                CONTAS_PAGAR_BAIXAS_AUX.IDEMPRESA = CONTAS_PAGAR_SALDOS_VIEW.IDEMPRESA AND
                CONTAS_PAGAR_BAIXAS_AUX.IDPLANILHA IN
                    (
                        SELECT
                            CONTAS_PAGAR.IDPLANILHA
                        FROM
                            DBA.CONTAS_PAGAR AS CONTAS_PAGAR
                        WHERE
                            CONTAS_PAGAR.IDPLANILHA = CONTAS_PAGAR_BAIXAS_AUX.IDPLANILHA AND
                            CONTAS_PAGAR.FLAGAGRUPADO = 'T'
                    )
            )
        LEFT JOIN
        DBA.FORMA_PAGREC AS FORMA_PAGREC ON
                (FORMA_PAGREC.IDRECEBIMENTO = CONTAS_PAGAR_SALDOS_VIEW.IDPAGAMENTO)
WHERE
    CONTAS_PAGAR_SALDOS_VIEW.IDEMPRESA IN (1,2,3,4,101,102,103) AND
    YEAR(CONTAS_PAGAR_SALDOS_VIEW.DTVENCIMENTO) >= 2022 AND
    CONTABIL_PLANO_CONTAS.IDCTACONTABIL IN ('2110101' , '4110221') AND
    CONTAS_PAGAR.FLAGBAIXADA = 'F'
GROUP BY
   -- CONTAS_PAGAR_SALDOS_VIEW.DTULTIMOPAGAMENTO,
   -- CONTAS_PAGAR_SALDOS_VIEW.SUMVALDESCCONCEDIDOTITULO,
   -- CONTAS_PAGAR_SALDOS_VIEW.SUMVALPAGAMENTOTITULO,
   -- CONTAS_PAGAR_SALDOS_VIEW.VALSALDOTITULO,
   -- CONTAS_PAGAR_SALDOS_VIEW.SUMVALJUROSMORA,
   -- CONTAS_PAGAR_SALDOS_VIEW.SUMVALJUROSCOBRADO,
   -- CONTAS_PAGAR_SALDOS_VIEW.SUMVALJUROSISENTADO,
   -- CONTAS_PAGAR_SALDOS_VIEW.SUMVALJUROSPOSTERGADO,
    --CONTAS_PAGAR_SALDOS_VIEW.VALLIQUIDOTITULO,
    --USUARIO.NOMEUSUARIO,
    CONTAS_PAGAR_SALDOS_VIEW.IDEMPRESA,
    EMPRESA.NOMEFANTASIA--,
    --CONTABIL_PLANO_CONTAS.IDCTACONTABIL--,
    --CLIENTE_FORNECEDOR.IDCLIFOR--,
    --CONTAS_PAGAR_SALDOS_VIEW.IDPLANILHA,
    --CONTAS_PAGAR_SALDOS_VIEW.DIGITOTITULO,
    --CONTAS_PAGAR_SALDOS_VIEW.SERIENOTA,
    --CONTAS_PAGAR_SALDOS_VIEW.IDPAGAMENTO,
    --CONTAS_PAGAR_SALDOS_VIEW.ORIGEMMOVIMENTO,
    --CONTAS_PAGAR_SALDOS_VIEW.VALTITULO,
    --CONTAS_PAGAR_SALDOS_VIEW.IDUSUARIO,
    --CONTAS_PAGAR_SALDOS_VIEW.FLAGCARTAOPROPRIO,
    --CONTAS_PAGAR_SALDOS_VIEW.DTMOVIMENTO,
    --CONTAS_PAGAR_SALDOS_VIEW.IDTITULO,
    --CONTAS_PAGAR_SALDOS_VIEW.DTVENCIMENTO,
    --CONTAS_PAGAR_SALDOS_VIEW.OBSTITULO,
    --CONTAS_PAGAR.CODIGOBARRAS,
    --CONTAS_PAGAR.CODIGOBOLETO,
    --CLIENTE_FORNECEDOR.NOME,
    --CONTAS_PAGAR_SALDOS_VIEW.IDCTACONTABIL,
    --CONTABIL_PLANO_CONTAS.DESCRCTACONTABIL
    --CONTABIL_PLANO_CONTAS_DEB.DESCRCTACONTABIL
    --CLIENTE_FORNECEDOR.TIPOCADASTRO,
    --CLIENTE_FORNECEDOR.FLAGCLIENTEVIP,
    --CONTAS_PAGAR.FLAGAGRUPADO,
    --CONTAS_PAGAR.FLAGTITULOBLOQUEADO,
    --CONTAS_PAGAR.DTAGENDAMENTO,
    --CONTAS_PAGAR.FLAGFLUXO,
    --CONTAS_PAGAR.DTEMISSAO,
    --CONTAS_PAGAR.FLAGBAIXADA,
    --CONTAS_PAGAR.DTVENCIMENTO,
    --FORMA_PAGREC.DESCRRECEBIMENTO,
    --CONTABIL_PLANO_CONTAS.IDCTACONTABIL